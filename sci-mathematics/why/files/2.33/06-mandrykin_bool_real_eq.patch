From a58ff7546924bb8d989fdd08d8fad28ba91c7958 Mon Sep 17 00:00:00 2001
From: Mikhail Mandrykin <mandrykin@ispras.ru>
Date: Fri, 10 Jan 2014 16:58:25 +0400
Subject: [PATCH 4/6] Used polymorphic equality for builtin bool and real
 types in Why3 output

---
 jc/output.ml |   10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/jc/output.ml b/jc/output.ml
index ffe25ca..848f272 100644
--- a/jc/output.ml
+++ b/jc/output.ml
@@ -622,6 +622,10 @@ let rec bool_to_prop t =
       (** by default *)
     | _ -> LPred("eq",[t;LConst(Prim_bool true)])
 
+let is_why3_poly_eq, is_why3_poly_neq =
+  let eqs = ["eq_int"; "eq_bool"; "eq_real"; "eq_int_"; "eq_bool_"; "eq_real_"] in
+  ListLabels.mem ~set:eqs, ListLabels.mem ~set:(List.map ((^) "n") eqs)
+
 let rec fprintf_term form t =
   match t with
   | LConst(c) -> fprintf_constant form c
@@ -740,7 +744,7 @@ and fprintf_assertion form a =
       fprintf form "@[(%a >= %a)@]"
 	fprintf_term t1
 	fprintf_term t2
-  | LPred(id,[t1;t2]) when id = "eq" || !why3syntax && id = "eq_int" ->
+  | LPred(id,[t1;t2]) when id = "eq" || !why3syntax && is_why3_poly_eq id ->
       fprintf form "@[(%a = %a)@]"
 	fprintf_term t1
 	fprintf_term t2
@@ -1094,10 +1098,10 @@ let rec fprintf_expr_node form e =
         fprintf form "@[<hov 0>(let %s =@ ref %a in@ %a)@]" (why3id_if id)
 	  fprintf_expr e1 fprintf_expr e2
     | App({expr_node = App({expr_node = Var id},e1,_)},e2,_)
-        when !why3syntax && id="eq_int_" ->
+        when !why3syntax && is_why3_poly_eq id ->
 	fprintf form "@[<hov 1>(%a = %a)@]" fprintf_expr e1 fprintf_expr e2
     | App({expr_node = App({expr_node = Var id},e1,_)},e2,_)
-        when !why3syntax && id="neq_int_" ->
+        when !why3syntax && is_why3_poly_neq id ->
 	fprintf form "@[<hov 1>(%a <> %a)@]" fprintf_expr e1 fprintf_expr e2
     | App(e1,e2,ty) when !why3syntax ->
 	fprintf form "@[<hov 1>(%a %a%a)@]" fprintf_expr e1 fprintf_expr e2
-- 
1.7.9.5

